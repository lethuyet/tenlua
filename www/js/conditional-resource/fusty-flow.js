!function(Flow,window,document){"use strict";function addEvent(element,type,handler){element.addEventListener?element.addEventListener(type,handler,!1):element.attachEvent?element.attachEvent("on"+type,handler):element["on"+type]=handler}function removeEvent(element,type,handler){element.removeEventListener?element.removeEventListener(type,handler,!1):element.detachEvent?element.detachEvent("on"+type,handler):element["on"+type]=null}function removeElement(element){element.parentNode.removeChild(element)}function isFunction(functionToCheck){var getType={};return functionToCheck&&"[object Function]"===getType.toString.call(functionToCheck)}function FustyFlow(opts){this.support=!1,this.files=[],this.events=[],this.defaults={simultaneousUploads:3,fileParameterName:"file",query:{},target:"/",generateUniqueIdentifier:null,matchJSON:!1};var $=this;this.inputChangeEvent=function(event){var input=event.srcElement;removeEvent(input,"change",$.inputChangeEvent);var newClone=input.cloneNode(!1);input.parentNode.replaceChild(newClone,input),$.addFile(input,event),newClone.value="",addEvent(newClone,"change",$.inputChangeEvent)},this.opts=Flow.extend({},this.defaults,opts||{})}function FustyFlowFile(flowObj,element){this.flowObj=flowObj,this.element=element,this.name=element.value&&element.value.replace(/.*(\/|\\)/,""),this.relativePath=this.name,this.uniqueIdentifier=flowObj.generateUniqueIdentifier(element),this.iFrame=null,this.finished=!1,this.error=!1;var $=this;this.iFrameLoaded=function(){if($.iFrame&&$.iFrame.parentNode){$.finished=!0;try{if($.iFrame.contentDocument&&$.iFrame.contentDocument.body&&"false"==$.iFrame.contentDocument.body.innerHTML)return}catch(error){return $.error=!0,$.abort(),void $.flowObj.fire("fileError",$,error)}var doc=$.iFrame.contentDocument||$.iFrame.contentWindow.document,innerHtml=doc.body.innerHTML;$.flowObj.opts.matchJSON&&(innerHtml=/(\{.*\})/.exec(innerHtml)[0]),$.abort(),$.flowObj.fire("fileSuccess",$,innerHtml),$.flowObj.upload()}},this.bootstrap()}var extend=Flow.extend,each=Flow.each;FustyFlow.prototype={on:Flow.prototype.on,fire:Flow.prototype.fire,cancel:Flow.prototype.cancel,assignBrowse:function(domNodes){"undefined"==typeof domNodes.length&&(domNodes=[domNodes]),each(domNodes,function(domNode){var input;"INPUT"===domNode.tagName&&"file"===domNode.type?input=domNode:(input=document.createElement("input"),input.setAttribute("type","file"),extend(domNode.style,{display:"inline-block",position:"relative",overflow:"hidden",verticalAlign:"top"}),extend(input.style,{position:"absolute",top:0,right:0,fontFamily:"Arial",fontSize:"118px",margin:0,padding:0,opacity:0,filter:"alpha(opacity=0)",cursor:"pointer"}),domNode.appendChild(input)),addEvent(input,"change",this.inputChangeEvent)},this)},assignDrop:function(){},unAssignDrop:function(){},isUploading:function(){var uploading=!1;return each(this.files,function(file){return file.isUploading()?(uploading=!0,!1):void 0}),uploading},upload:function(){var files=0;each(this.files,function(file){if(1!=file.progress()){if(file.isUploading())return void files++;if(files++>=this.opts.simultaneousUploads)return!1;1==files&&this.fire("uploadStart"),file.send()}},this),files||this.fire("complete")},pause:function(){each(this.files,function(file){file.abort()})},resume:function(){this.upload()},progress:function(){var totalDone=0,totalFiles=0;return each(this.files,function(file){totalDone+=file.progress(),totalFiles++}),totalFiles>0?totalDone/totalFiles:0},addFiles:function(elementsList,event){var files=[];each(elementsList,function(element){if(1===element.nodeType&&element.value){var f=new FustyFlowFile(this,element);this.fire("fileAdded",f,event)&&files.push(f)}},this),this.fire("filesAdded",files,event)&&each(files,function(file){this.opts.singleFile&&this.files.length>0&&this.removeFile(this.files[0]),this.files.push(file)},this),this.fire("filesSubmitted",files,event)},addFile:function(file,event){this.addFiles([file],event)},generateUniqueIdentifier:function(element){var custom=this.opts.generateUniqueIdentifier;return"function"==typeof custom?custom(element):"xxxxxxxx-xxxx-yxxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(c){var r=16*Math.random()|0,v="x"==c?r:3&r|8;return v.toString(16)})},getFromUniqueIdentifier:function(uniqueIdentifier){var ret=!1;return each(this.files,function(f){f.uniqueIdentifier==uniqueIdentifier&&(ret=f)}),ret},removeFile:function(file){for(var i=this.files.length-1;i>=0;i--)this.files[i]===file&&this.files.splice(i,1)},getSize:function(){},timeRemaining:function(){},sizeUploaded:function(){}},FustyFlowFile.prototype={getExtension:Flow.FlowFile.prototype.getExtension,getType:function(){},send:function(){if(!this.finished){var o=this.flowObj.opts,form=this.createForm(),params=o.query;isFunction(params)&&(params=params(this)),params[o.fileParameterName]=this.element,params.flowFilename=this.name,params.flowRelativePath=this.relativePath,params.flowIdentifier=this.uniqueIdentifier,this.addFormParams(form,params),addEvent(this.iFrame,"load",this.iFrameLoaded),form.submit(),removeElement(form)}},abort:function(){this.iFrame&&(this.iFrame.setAttribute("src","java"+String.fromCharCode(115)+"cript:false;"),removeElement(this.iFrame),this.iFrame=null)},cancel:function(){this.abort(),this.flowObj.removeFile(this)},retry:function(){this.bootstrap(),this.flowObj.upload()},bootstrap:function(){this.abort(),this.error=!1},timeRemaining:function(){},sizeUploaded:function(){},resume:function(){this.flowObj.upload()},pause:function(){this.abort()},isUploading:function(){return null!==this.iFrame},isComplete:function(){return 1===this.progress()},progress:function(){return this.error?1:this.finished?1:0},createIframe:function(){var iFrame=document.createElement(/MSIE (6|7|8)/.test(navigator.userAgent)?'<iframe name="'+this.uniqueIdentifier+'_iframe">':"iframe");return iFrame.setAttribute("id",this.uniqueIdentifier+"_iframe_id"),iFrame.setAttribute("name",this.uniqueIdentifier+"_iframe"),iFrame.style.display="none",document.body.appendChild(iFrame),iFrame},createForm:function(){var target=this.flowObj.opts.target,form=document.createElement("form");return form.encoding="multipart/form-data",form.method="POST",form.setAttribute("action",target),this.iFrame||(this.iFrame=this.createIframe()),form.setAttribute("target",this.iFrame.name),form.style.display="none",document.body.appendChild(form),form},addFormParams:function(form,params){var input;each(params,function(value,key){value&&1===value.nodeType?input=value:(input=document.createElement("input"),input.setAttribute("value",value)),input.setAttribute("name",key),form.appendChild(input)})}},FustyFlow.FustyFlowFile=FustyFlowFile,"undefined"!=typeof module?module.exports=FustyFlow:"function"==typeof define&&define.amd?define(function(){return FustyFlow}):window.FustyFlow=FustyFlow}(window.Flow,window,document);